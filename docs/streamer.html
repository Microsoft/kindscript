<html>
<head>
    <meta charset="UTF-8">
    <title>Microsoft MakeCode Streamer</title>
    <style>

/*
  Your use of the content in the files referenced here is subject to the terms of the license at https://aka.ms/fabric-assets-license
  Use https://uifabricicons.azurewebsites.net/
*/
@font-face {
  font-family: 'FabricMDL2Icons';
  src: url('data:application/octet-stream;base64,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') format('truetype');
}

.ms-Icon {
  -moz-osx-font-smoothing: grayscale;
  -webkit-font-smoothing: antialiased;
  display: inline-block;
  font-family: 'FabricMDL2Icons';
  font-style: normal;
  font-weight: normal;
  speak: none;
}

.ms-Icon--Settings:before { content: "\E713"; }

    </style>
    <style>
        /* 
            Style for the background. 
            
            Generate your custom css gradients at https://cssgradient.io/ 
        */
        body {
            font-family: monospace;
        }

        footer {
            font-size: 70%;
            color: white;
            position: absolute;
            bottom: 0.5vh;
            left: 1vw;
            opacity: 65%;
        }

        footer>a {
            color: white;
            text-decoration: none;
        }

        /* 
            Style for the boxes.

            https://alligator.io/css/gradient-borders-pure-css/ 
        */
        .box {
            border: 0.5rem solid;
            border-radius: 0.5rem;

            transition: left 0.5s, right 0.5s, bottom 0.5s, top 0.5s, width 0.5s, height 0.5s, opacity 1s;
        }

        .hidden {
            display: none;
        }

        .rotate {
            transform: rotate(180deg);
            transform-origin: 50% 50%;
        }
        .ms-Icon {
            vertical-align: middle;
            margin-right: 0.5rem;
        }
        /*
        Settings
        */
        #settings {
            position: absolute;
            left: 16vw;
            top: 16vh;
            width: 58vw;
            height: 58vh;
            background: #ccc;
            padding: 5vh 5vw 5vh 5vw;
            overflow-y: auto;
        }

        #settings .field {
            padding: 1vh 0 1vh 0;
        }

        #settings .field input {
            width: 100%;
            font-size: 90%;
        }

        #settings .field input[type="checkbox"] {
            width: unset;
        }

        #settings .field select {
            width: 100%;
            font-size: 90%;
        }

        #settings #settingsclose {
            position: absolute;
            right: 2vw;
            top: 2vw;
        }

        /*
            MakeCode editor box
        */
        #editor {
            position: absolute;
            width: 94vw;
            height: 87vh;
            top: 1vh;
        }
        .multi #editor {
            width: 50vw;
        }
        #editor2 {
            position: absolute;
            width: 50vw;
            height: 87vh;
            top: 1vh;
        }

        /*
            Face camera            
        */
        #facecam {
            position: absolute;
            width: 30vw;
            bottom: 1.5vh;
            right: 1vw;
        }

        /*
            Chat window
        */
        #chat {
            position: absolute;
            width: 30vw;
            height: 60vh;
            top: 1vh;
            right: 1vw;
            opacity: 0;
        }

        #social {
            position: absolute;
            width: 60vw;
            height: 5vh;
            left: 1vw;
            bottom: 2vh;
            display: flex;
            background: #615fc7;
        }

        span.social {
            font-size: 2.5vh;
            color: white;
            flex-grow: 1;
            margin: 1vh 2vw 1vh 2vw;
            text-align: center;
            cursor: pointer;
        }

        /** 
        * chat visibility
        */
        body.chat #chat {
            opacity: 90%;
        }

        /* startingsoon scene */
        body.startingsoonscene #editor,
        body.startingsoonscene #facecam {
            display: none;
        }

        /* rightscene: browser with facecam on right */
        body.rightscene #editor {
            left: 1vw;
        }

        body.rightscene #facecam {
            right: 1vw;
            width: 30vw;
        }

        body.rightscene #chat {
            right: 1vw;
            width: 30vw;
            height: 63vh;
        }

        body.rightscene.chat #editor {
            width: 65vw;
            top: 1vh;
            height: 87vh;
        }
        body.rightscene.multi #editor {
            width: 66vw;
        }
        body.rightscene.multi #editor2 {
            width: 30vw;
            left: 68vw;
            height: 52vh;
        }

        /* leftscene: browser with facecam on left left */
        body.leftscene #editor {
            left: 4vw;
            height: 87vh;
        }

        body.leftscene #facecam {
            right: 68vw;
            width: 30vw;
        }

        body.leftscene #social {
            width: 55vw;
            height: 5vh;
            left: 43vw;
            bottom: 1.5vh;
        }
        /* left+multi*/
        body.leftscene.multi #editor {
            left: 1vw;
            width: 30vw;
            height: 52vh;
        }
        body.leftscene.multi #editor2 {
            width: 66vw;
            left: 32vw;
        }
        body.leftscene.multi #facecam {
            right: 68vw;
            width: 30vw;
        }

        /** leftscene + chat **/
        body.leftscene.chat #editor {
            left: 33vw;
            width: 65vw;
        }

        body.leftscene.chat #facecam {
            right: 68vw;
            width: 30vw;
        }

        body.leftscene.chat #chat {
            right: 68vw;
            height: 63vh;
        }

        /* chatscene: facecam and stream chat */
        body.chatscene #facecam {
            bottom: 26vh;
            right: 33vw;
            width: 63vw;
        }

        body.chatscene #editor {
            opacity: 0;
        }

        body.chatscene #chat {
            top: 10vh;
            right: 4vw;
            width: 24vw;
            height: 63vh;
            opacity: 100%;
        }

        body.chatscene #social {
            left: 4vw;
            bottom: 14vh;
        }
    </style>
    <style id="editorstyle"></style>
</head>

<body class="rightscene chat">
    <iframe class="box" id="editor"></iframe>
    <iframe class="box" id="editor2"></iframe>
    <iframe class="box" id="chat"></iframe>
    <video class="box" autoplay="true" id="facecam"></video>
    <div class="box" id="social"></div>
    <div class="box" id="settings">
        <button id="settingsclose">close</button>
        <h2>MakeCode Streamer settings</h2>
        <div class="field">
            <label for="editorselect">Choose your editor</label>
            <select id="editorselect"></select>
        </div>
        <div class="field">
            <input type="checkbox" id="multicheckbox"></input>
            <label for="multicheckbox">Multi editors</label>
        </div>
        <h2>Video</h2>
        <div class="field">
            <label for="faceselect">Choose a Webcam</label>
            <select id="facecamselect"></select>
        </div>
        <div class="field">
            <input type="checkbox" id="rotatecameracheckbox"></input>
            <label for="rotatecameracheckbox">Rotate camera 180</label>
        </div>
        <h2>Social accounts</h2>
        <div class="field">
            <label for="twitterinput">Twitter (optional)</label>
            <input id="twitterinput" placeholder="Twitter handle (@account)" />
        </div>
        <div class="field">
            <label for="youtubeinput"">YouTube (optional)</label>
            <input id="youtubeinput" placeholder="YouTube account (/account)" />
        </div>
        <div class="field">
            <label for="mixerinput">Mixer (optional)</label>
            <input id="mixerinput" placeholder="Mixer.com account (/account)" />
        </div>
        <div class="field">
            <label for="twitchinput">Twitch (optional)</label>
            <input id="twitchinput" placeholder="Twitch.tv account (/account)" />
        </div>
    </div>
    <!-- @include tracking.html -->
    <footer>
        <a class="item" href="https://makecode.com/privacy" target="_blank" rel="noopener">Privacy &amp; Cookies</a>|
        <a class="item" href="https://makecode.com/termsofuse" target="_blank" rel="noopener">Terms Of Use</a>|
        <a class="item" href="https://makecode.com/trademarks" target="_blank" rel="noopener">Trademarks</a>|
        <span class="item">© 2020 Microsoft</span>|
        <span id="settingsbtn" class="item" role="button"><i role="button" class="ms-Icon ms-Icon--Settings"></i>settings</span>
    </footer>
    <script>
        (async function () {
            const body = document.body;
            const editor = document.getElementById("editor");
            const editor2 = document.getElementById("editor2");
            const facecam = document.getElementById("facecam");
            const chat = document.getElementById("chat");
            const social = document.getElementById("social");
            const settings = document.getElementById("settings");
            const editorStyle = document.getElementById("editorstyle");
            const settingsbtn = document.getElementById("settingsbtn");
            const frames = [editor, editor2];

            const scenes = ["leftscene", "rightscene", "chatscene"];
            const editorConfigs = await fetchJSON("/editors.json");
            const state = {
                sceneIndex: 1,
                left: false,
                chat: false
            }

            facecam.addEventListener("pointerdown", nextScene, false);
            social.addEventListener("pointerdown", toggleChat, false);
            settingsbtn.addEventListener("pointerdown", showSettings, false)
            initMessages();
            await loadFaceCam()
            await loadSettings()
            load();

            function load() {
                loadEditor()
                loadChat()
                loadSocial()
                render()
            }

            function saveConfig(config) {
                if (!config) throw "missing config"
                localStorage["streamer.config"] = JSON.stringify(config)
            }

            function showSettings() {
                settings.classList.remove("hidden")
            }

            function readConfig() {
                try {
                    const cfg = JSON.parse(localStorage["streamer.config"]);
                    return cfg;
                } catch (e) {
                    console.log(e)
                }

                showSettings()
                return {
                    editor: "microbit",
                    multiEditor: false,
                    twitter: "MsMakeCode",
                    youTube: "",
                    mixer: "MakeCode",
                    faceCamId: undefined,
                    faceCamRotate: false
                }
            }

            async function fetchJSON(url) {
                const resp = await fetch(url)
                const json = await resp.json();
                return json;
            }

            function render() {
                const config = readConfig();
                body.className = `${scenes[state.sceneIndex]} ${state.chat ? "chat" : ""} ${config.multiEditor ? "multi" : ""}`
            }

            function loadEditor() {
                const config = readConfig();
                const hash = window.location.hash.substr(1);

                // update first editor
                const editorConfig = editorConfigs[hash] || editorConfigs[config.editor] || editorConfigs["microbit"]
                let url = `${editorConfig.url}?editorLayout=ide&nosandbox=1`;
                if (config.multiEditor)
                    url += `&nestededitorsim=1`;
                editor.src = url;
                if (config.multiEditor) {
                    if (!editor2.parentElement)
                        body.insertBefore(editor2, editor);
                    editor2.src = url;
                } else {
                    // remove from DOM
                    editor2.remove();
                }

                // update page style
                let css = "";
                const styles = editorConfig.styles;
                if (styles) {
                    css =
                        `body {
    background: ${styles.background};
}
.box {
    border-color: ${styles.menu};
}`
                } else {
                    css =
                        `body {
    background: rgb(99, 93, 198);
    background: linear-gradient(45deg, rgba(99, 93, 198, 1) 0%, rgba(0, 212, 255, 1) 100%);
}
.box {
    border-image: conic-gradient(red, yellow, lime, aqua, blue, magenta, red) 1;
}`
                }
                editorStyle.innerText = ""
                editorStyle.append(document.createTextNode(css));
            }

            function stopEvent(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            function toggleChat(e) {
                stopEvent(e)
                const config = readConfig();
                state.chat = !state.chat && (config.mixer || config.twitch);
                if (!state.chat && scenes[state.sceneIndex] == "chatscene") {
                    state.sceneIndex = state.left ? 0 : 1;
                }
                render();
            }

            function nextScene(e) {
                stopEvent(e)
                if (scenes[state.sceneIndex] == "chatscene") {
                    state.sceneIndex = state.left ? 0 : 1;
                } else if (state.chat) {
                    state.sceneIndex = 2;
                } else {
                    state.left = !state.left;
                    state.sceneIndex = state.left ? 0 : 1;
                }
                render();
            }

            function loadSocial() {
                const config = readConfig();
                social.innerHTML = ''
                if (config.twitter)
                    addSocial(`@${config.twitter}`)
                if (config.youTube)
                    addSocial(`youtube.com/${config.youTube}`);
                if (config.mixer)
                    addSocial(`mixer.com/${config.mixer}`);
                else if (config.twitch)
                    addSocial(`twitch.tv/${config.twitch}`);

                if (!config.mixer && !config.twitch)
                    state.chat = false;

                function addSocial(text) {
                    const a = document.createElement("span");
                    a.className = "social"
                    a.innerText = text
                    social.append(a)
                }
            }

            function loadChat() {
                const config = readConfig();
                if (config.mixer) {
                    chat.src = `https://mixer.com/embed/chat/${config.mixer}?composer=false`;
                    if (!chat.parentElement)
                        body.insertBefore(chat, facecam)
                }
                else if (config.twitch) {
                    chat.src = `https://www.twitch.tv/embed/${config.twitch}/chat?parent=makecode.com`;
                    if (!chat.parentElement)
                        body.insertBefore(chat, facecam)
                }
                else // remove from dom
                    chat.remove();
            }

            async function listCameras() {
                let cams = await navigator.mediaDevices.enumerateDevices()
                cams = cams.filter(d => d.kind == "videoinput")
                return cams;
            }

            async function loadFaceCam() {
                // load previous webcam
                const config = readConfig();
                if (config.faceCamId) {
                    try {
                        startStream(config.faceCamId);
                        return; // success!
                    }
                    catch (e) {
                        console.log(`could not start previous web cam`, e)
                    }
                }
                // try out all webcams
                const cams = await listCameras()
                for (const cam of cams) {
                    try {
                        await startStream(cam.deviceId);
                        config.faceCamId = cam.deviceId;
                        saveConfig(config)
                        return; // success!
                    } catch (e) {
                        console.log(`could not start web cam`, e)
                    }
                }
                // no web cam available
            }

            function stopStream() {
                try {
                    if (facecam.srcObject) {
                        const tracks = facecam.srcObject.getVideoTracks();
                        if (tracks && tracks[0] && tracks[0].stop) tracks[0].stop();
                    }
                    facecam.srcObject = null;
                } catch (e) { }
            }

            function initMessages() {
                window.onmessage = function (msg) {
                    const data = msg.data;
                    const source = msg.source;
                    if (!!data.broadcast) {
                        data.outer = true;
                        frames
                            .filter(ifrm => ifrm.contentWindow !== source)
                            .forEach((ifrm) => ifrm.contentWindow.postMessage(data, "*"));
                    }
                };
            }

            async function startStream(deviceId) {
                stopStream()
                const config = readConfig();
                console.log(`trying webcam ${deviceId}`)
                const constraints = { audio: false, video: { deviceId: deviceId } }
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                facecam.volume = 0; // don't use sound!
                facecam.srcObject = stream;
                facecam.onloadedmetadata = (e) => facecam.play();
                if (config.faceCamRotate)
                    facecam.classList.add("rotate")
                else
                    facecam.classList.remove("rotate");
            }

            async function loadSettings() {
                const config = readConfig();
                const settingsclose = document.getElementById("settingsclose")
                settingsclose.onclick = function (e) {
                    stopEvent(e)
                    settings.classList.add("hidden")
                }
                const editorselect = document.getElementById("editorselect");
                editorselect.innerHTML = "" // remove all web cams
                Object.keys(editorConfigs).forEach(editorid => {
                    const option = document.createElement("option")
                    option.value = editorid
                    option.text = editorConfigs[editorid].name;
                    editorselect.add(option)
                    if (config.editor == editorid)
                        option.selected = true;
                })
                editorselect.onchange = function () {
                    const selected = editorselect.options[editorselect.selectedIndex];
                    config.editor = selected.value;
                    saveConfig(config);
                    render()
                    loadEditor();
                }

                const multicheckbox = document.getElementById("multicheckbox")
                multicheckbox.checked = !!config.multiEditor
                multicheckbox.onchange = function () {
                    config.multiEditor = !!multicheckbox.checked
                    saveConfig(config)
                    render()
                    loadEditor()
                }

                const facecamselect = document.getElementById("facecamselect");
                facecamselect.innerHTML = "" // remove all web cams
                const cams = await listCameras()
                cams.forEach(cam => {
                    const option = document.createElement("option")
                    option.value = cam.deviceId
                    option.text = cam.label
                    facecamselect.add(option)
                    if (config.faceCamId == cam.deviceId)
                        option.selected = true;
                })
                facecamselect.onchange = function () {
                    const selected = facecamselect.options[facecamselect.selectedIndex];
                    config.faceCamId = selected.value;
                    saveConfig(config)
                    loadFaceCam().then(() => loadSettings())
                }

                const rotatecheckbox = document.getElementById("rotatecameracheckbox")
                rotatecheckbox.checked = !!config.faceCamRotate
                rotatecheckbox.onchange = function () {
                    config.faceCamRotate = !!rotatecheckbox.checked
                    saveConfig(config)
                    loadFaceCam()
                }

                const twitterinput = document.getElementById("twitterinput")
                twitterinput.value = config.twitter || ""
                twitterinput.onchange = function (e) {
                    config.twitter = (twitterinput.value || "").replace(/^https:\/\/twitter.com\//, '').replace(/^@/, '').trim()
                    twitterinput.value = config.twitter
                    saveConfig(config);
                    loadSocial()
                    render()
                }

                const youtubeinput = document.getElementById("youtubeinput")
                youtubeinput.value = config.youTube || ""
                youtubeinput.onchange = function (e) {
                    config.youTube = (youtubeinput.value || "").replace(/^https:\/\/youtube.com\//, '').replace(/^\//, '').trim()
                    youtubeinput.value = config.youTube
                    saveConfig(config);
                    loadSocial();
                    render()
                }

                const twitchinput = document.getElementById("twitchinput")
                twitchinput.value = config.twitch || ""
                twitchinput.onchange = function (e) {
                    config.twitch = (twitchinput.value || "").replace(/^https:\/\/twitch.tv\//, '').replace(/^\//, '').trim()
                    twitchinput.value = config.twitch
                    saveConfig(config);
                    loadSocial();
                    render()
                    loadChat();
                }

                const mixerinput = document.getElementById("mixerinput")
                mixerinput.value = config.mixer || ""
                mixerinput.onchange = function (e) {
                    config.mixer = (mixerinput.value || "").replace(/^https:\/\/mixer.com\//, '').replace(/^\//, '').trim()
                    mixerinput.value = config.mixer
                    saveConfig(config);
                    render()
                    loadSocial();
                    loadChat();
                }
            }
        })()
    </script>
</body>

</html>